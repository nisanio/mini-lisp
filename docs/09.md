# Chapter 9 — REPL and Program Execution (`repl.c`, `main.c`)

## 9.1 Overview

Mini Lisp provides both **interactive execution** via a REPL and **batch execution** of `.lisp` files. These facilities are implemented in `repl.c` and `main.c`.

## 9.2 REPL (`repl.c`)

The Read–Eval–Print Loop repeatedly performs:

1. **Prompt**: Displays a prompt (optional, depending on build flags).
2. **Read**: Uses the reader to parse input into `Value*` expressions.
3. **Eval/Expand**: Sends the expression to the evaluator, which applies macro expansion and execution.
4. **Print**: Uses `print_value` to display the result.
5. **Loop**: Continues until EOF or explicit exit.

Features:

* Can load standard library before starting.
* Error messages are printed but REPL continues.

## 9.3 Program Execution (`main.c`)

* **Initialization**:

  * Create the global environment via `make_global()`.
  * Install constants (`#t`, `#f`, `nil`) and builtins.
* **Command-line arguments**:

  * If files are provided, load them in sequence using the reader and evaluator.
  * If no files are provided, enter interactive REPL mode.
* **Exit status**:

  * Normally `0`.
  * Errors print messages to stderr but do not change exit code (configurable for stricter modes).

## 9.4 File Loading

* Implemented by reading a file into a string (`read-file`) and parsing expressions.
* Each expression is evaluated in sequence within the current environment.
* Supports scripts that bootstrap with macros and definitions.

## 9.5 Integration with Standard Library

* `stdlib.lisp` is typically loaded at startup to extend functionality.
* Ensures higher-level forms (`map`, `filter`, `when`, etc.) are available in both REPL and script mode.

## 9.6 Example Usage

Interactive mode:

```bash
$ ./minilisp
> (define-syntax when (syntax-rules () ((when test body ...) (if test (begin body ...) nil))))
> (when #t (print "hi"))
hi
```

Batch mode:

```bash
$ ./minilisp stdlib.lisp examples/fib.lisp
233
```

---

Next chapter: **Memory Management** — allocation conventions, ownership rules, and portability considerations.
