# Chapter 3 — Data Model (`value.[ch]`)

## 3.1 Value Representation

All runtime objects in Mini Lisp are represented by the `Value` type, a tagged union covering primitive and composite forms.

### Core Tags

* **`VAL_NIL`** — The empty list / `nil`.
* **`VAL_BOOL`** — Boolean values `#t` and `#f`.
* **`VAL_INT`** — 64-bit signed integers.
* **`VAL_SYMBOL`** — Interned symbols stored in a global table.
* **`VAL_STRING`** — Heap-allocated strings with length tracking.
* **`VAL_PAIR`** — Cons cells (`car`/`cdr`) for building lists.
* **`VAL_VECTOR`** — Indexed arrays.
* **`VAL_HASH`** — Hash tables for mapping keys to values.
* **`VAL_BUILTIN`** — C functions exposed to Lisp.
* **`VAL_CLOSURE`** — User-defined functions with lexical environment.

## 3.2 Constructors and Utilities

* **Allocation helpers**: `make_int`, `make_symbol`, `make_string`, `cons`, `make_vector`, `make_hash`, `make_builtin`, `make_closure`.
* **Predicates**: `is_nil`, `is_bool`, `is_symbol`, `is_pair`, `is_vector`, `is_hash`.
* **Copying**: Strings duplicated with `xstrdup` (portable, avoids non-standard `strdup`).

## 3.3 Lists

* Represented by nested `VAL_PAIR` objects.
* Utilities: `list_length`, `is_proper_list`, `array_to_list`, `list_to_array`.
* Traversal: `car`, `cdr` accessors with null-checks.

## 3.4 Symbols

* Interned: each distinct symbol string stored once in a global table.
* Fast equality by pointer comparison.
* Created with `make_symbol`, using `xstrdup` to ensure safe allocation.

## 3.5 Strings

* Structure: `(char* data, size_t len)`.
* Immutable from Lisp’s perspective; copied on creation.
* Printable with escaping in `print_value`.

## 3.6 Vectors and Hash Tables

* **Vector**: dynamic array with indexed access.
* **Hash**: key–value store (implementation detail: likely open addressing or chaining, depending on `value.c`).
* Both exposed with builtins for construction, access, and mutation.

## 3.7 Truthiness and Equality

* `nil` and `#f` are false.
* All other values are true.
* Equality: `eq?` for identity; deep comparison for composite structures is limited.

## 3.8 Printing

* `print_value` handles each type:

  * Integers, booleans, nil as literals.
  * Symbols by name.
  * Strings with escaping.
  * Pairs as `(a b c)` notation.
  * Closures and builtins as `#<closure>` / `#<builtin>`.

---

This chapter establishes the core runtime representation. The next chapter will describe **Environments (`env.[ch]`)**, where these values are bound and resolved.
